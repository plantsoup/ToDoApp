<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Todo App</title>
<style>
  body { font-family: sans-serif; padding: 2rem; max-width: 600px; margin: auto; }
  h1 { text-align: center; }
  ul { list-style: none; padding: 0; }
  li { display: flex; align-items: center; justify-content: space-between; margin: 0.5rem 0; padding: 0.5rem; border: 1px solid #ddd; border-radius: 5px; }
  li.done span { text-decoration: line-through; color: #999; }
  button { margin-left: 0.5rem; }
  input { flex: 1; padding: 0.5rem; font-size: 1rem; }
  #todoForm { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
</style>
</head>
<body>
<h1>Todo App</h1>

<form id="todoForm">
  <input type="text" id="todoInput" placeholder="New todo" required />
  <button type="submit">Add Todo</button>
</form>

<ul id="todoList"></ul>

<script>
const WORKER_URL = "https://to-do.gav-c8d.workers.dev"; // Your Worker API

async function fetchTodos() {
  try {
    const res = await fetch(`${WORKER_URL}/api/todos`);
    const todos = await res.json();
    const list = document.getElementById('todoList');
    list.innerHTML = '';
    todos.forEach(todo => {
      const li = document.createElement('li');
      li.className = todo.done ? 'done' : '';
      
      const span = document.createElement('span');
      span.textContent = todo.text;
      span.onclick = async () => toggleDone(todo);
      li.appendChild(span);

      const del = document.createElement('button');
      del.textContent = 'Delete';
      del.onclick = async () => {
        await fetch(`${WORKER_URL}/api/todos/${todo.id}`, { method: 'DELETE' });
        fetchTodos();
      };
      li.appendChild(del);

      list.appendChild(li);
    });
  } catch (err) {
    console.error("Error fetching todos:", err);
  }
}

// Optional: toggle done (frontend only for now)
async function toggleDone(todo) {
  todo.done = !todo.done;
  // Send to API if Worker supports "done" column
  // await fetch(`${WORKER_URL}/api/todos/${todo.id}`, { method: 'PATCH', body: JSON.stringify({ done: todo.done }) });
  fetchTodos();
}

document.getElementById('todoForm').onsubmit = async (e) => {
  e.preventDefault();
  const input = document.getElementById('todoInput');
  await fetch(`${WORKER_URL}/api/todos`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ text: input.value })
  });
  input.value = '';
  fetchTodos();
};

// Initial fetch
fetchTodos();
</script>
</body>
</html>
